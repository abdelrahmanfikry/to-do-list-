<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سجل أهدافي وخطتي اليومية</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4a6bff;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --text-color: #333;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
            --border-color: #e0e0e0;
        }

        [data-theme="dark"] {
            --primary-color: #5d7aff;
            --secondary-color: #868e96;
            --success-color: #3bd963;
            --danger-color: #ff6b6b;
            --warning-color: #ffd43b;
            --info-color: #3bc9db;
            --light-color: #343a40;
            --dark-color: #f8f9fa;
            --text-color: #f1f3f5;
            --bg-color: #212529;
            --card-bg: #2b3035;
            --border-color: #495057;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        header h1 {
            font-size: 28px;
            color: var(--primary-color);
        }

        header h1 i {
            margin-left: 10px;
        }

        .motivational-banner {
            background-color: var(--primary-color);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            text-align: center;
            font-size: 18px;
            font-weight: 500;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .stat-card h3 {
            font-size: 16px;
            margin-bottom: 10px;
            color: var(--secondary-color);
        }

        .stat-card p {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h2 {
            font-size: 22px;
            color: var(--primary-color);
        }

        .section-header h2 i {
            margin-left: 10px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .btn-primary:hover {
            background-color: #3a56d4;
        }

        .goals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .goal-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
            position: relative;
        }

        .goal-card:hover {
            transform: translateY(-5px);
        }

        .goal-card h3 {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .goal-dates {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 14px;
            color: var(--secondary-color);
        }

        .goal-note {
            font-size: 14px;
            color: var(--text-color);
            margin-bottom: 15px;
            padding: 10px;
            background-color: rgba(74, 107, 255, 0.1);
            border-radius: 5px;
            border-right: 3px solid var(--primary-color);
        }

        .progress-container {
            margin-bottom: 15px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .progress-bar {
            height: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.5s ease;
        }

        .goal-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            color: var(--secondary-color);
            transition: color 0.3s;
            padding: 5px 10px;
            border-radius: 4px;
        }

        .action-btn:hover {
            color: var(--primary-color);
            background-color: rgba(74, 107, 255, 0.1);
        }

        .action-btn i {
            margin-left: 5px;
        }

        .todo-list {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .todo-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
            cursor: move;
        }

        .todo-item:last-child {
            border-bottom: none;
        }

        .todo-checkbox {
            margin-left: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .todo-text {
            flex-grow: 1;
            font-size: 16px;
        }

        .todo-text.completed {
            text-decoration: line-through;
            color: var(--secondary-color);
        }

        .todo-due-date {
            font-size: 12px;
            color: var(--secondary-color);
            margin-right: 15px;
        }

        .todo-actions {
            display: flex;
        }

        .todo-actions button {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--secondary-color);
            margin-right: 10px;
            font-size: 16px;
            transition: color 0.3s;
        }

        .todo-actions button:hover {
            color: var(--primary-color);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            overflow: auto;
        }

        .modal-content {
            background-color: var(--card-bg);
            margin: 10% auto;
            padding: 25px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .close {
            position: absolute;
            top: 15px;
            left: 15px;
            font-size: 24px;
            color: var(--secondary-color);
            cursor: pointer;
        }

        .close:hover {
            color: var(--text-color);
        }

        .modal h2 {
            margin-bottom: 20px;
            color: var(--primary-color);
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: var(--card-bg);
            color: var(--text-color);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .theme-switch {
            display: flex;
            align-items: center;
        }

        .theme-switch span {
            margin-left: 10px;
            font-size: 14px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .filters select {
            padding: 8px 12px;
            border-radius: 5px;
            border: 1px solid var(--border-color);
            background-color: var(--card-bg);
            color: var(--text-color);
        }

        /* تأثيرات للتحفيز */
        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1001;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 0.5s;
        }

        .celebration.show {
            opacity: 1;
            pointer-events: auto;
        }

        .celebration-content {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            max-width: 80%;
        }

        .celebration-content h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .celebration-content p {
            font-size: 18px;
            margin-bottom: 20px;
        }

        .urgent-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: var(--danger-color);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        .goal-badge {
            background-color: rgba(74, 107, 255, 0.1);
            color: var(--primary-color);
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-right: 10px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .goals-grid {
                grid-template-columns: 1fr;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .section-header .btn-primary {
                margin-top: 10px;
            }
            
            .goal-actions {
                flex-wrap: wrap;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-bullseye"></i> سجل أهدافي وخطتي اليومية</h1>
            <div class="theme-switch">
                <span>وضع ليلي</span>
                <label class="switch">
                    <input type="checkbox" id="darkModeToggle">
                    <span class="slider round"></span>
                </label>
            </div>
        </header>

        <div class="motivational-banner">
            <p id="motivationalQuote">"كل يوم صغير يقربك لهدفك الكبير!"</p>
        </div>

        <div class="stats-container">
            <div class="stat-card">
                <h3>الأهداف المكتملة</h3>
                <p id="completedGoals">0</p>
            </div>
            <div class="stat-card">
                <h3>المهام المكتملة</h3>
                <p id="completedTasks">0</p>
            </div>
            <div class="stat-card">
                <h3>نسبة التقدم</h3>
                <p id="overallProgress">0%</p>
            </div>
        </div>

        <section class="goals-section">
            <div class="section-header">
                <h2><i class="fas fa-flag"></i> أهدافي</h2>
                <button id="addGoalBtn" class="btn-primary">
                    <i class="fas fa-plus"></i> إضافة هدف جديد
                </button>
            </div>

            <div id="goalsContainer" class="goals-grid">
                <!-- الأهداف ستضاف هنا ديناميكيًا -->
            </div>
        </section>

        <section class="todo-section">
            <div class="section-header">
                <h2><i class="fas fa-tasks"></i> مهام اليوم</h2>
                <div class="filters">
                    <select id="goalFilter">
                        <option value="all">كل الأهداف</option>
                    </select>
                </div>
            </div>

            <div id="todoContainer" class="todo-list">
                <!-- المهام ستضاف هنا ديناميكيًا -->
            </div>
        </section>
    </div>

    <!-- Modal إضافة هدف جديد -->
    <div id="goalModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>إضافة هدف جديد</h2>
            <form id="goalForm">
                <div class="form-group">
                    <label for="goalName">اسم الهدف</label>
                    <input type="text" id="goalName" required placeholder="مثال: تعلم برمجة الويب">
                </div>
                <div class="form-group">
                    <label for="startDate">تاريخ البداية</label>
                    <input type="date" id="startDate" required>
                </div>
                <div class="form-group">
                    <label for="endDate">تاريخ النهاية</label>
                    <input type="date" id="endDate" required>
                </div>
                <div class="form-group">
                    <label for="goalNote">ملاحظة أو نصيحة</label>
                    <textarea id="goalNote" rows="3" placeholder="اكتب ملاحظة تحفيزية لنفسك..."></textarea>
                </div>
                <button type="submit" class="btn-primary">حفظ الهدف</button>
            </form>
        </div>
    </div>

    <!-- Modal تعديل هدف -->
    <div id="editGoalModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>تعديل الهدف</h2>
            <form id="editGoalForm">
                <input type="hidden" id="editGoalId">
                <div class="form-group">
                    <label for="editGoalName">اسم الهدف</label>
                    <input type="text" id="editGoalName" required placeholder="مثال: تعلم برمجة الويب">
                </div>
                <div class="form-group">
                    <label for="editStartDate">تاريخ البداية</label>
                    <input type="date" id="editStartDate" required>
                </div>
                <div class="form-group">
                    <label for="editEndDate">تاريخ النهاية</label>
                    <input type="date" id="editEndDate" required>
                </div>
                <div class="form-group">
                    <label for="editGoalNote">ملاحظة أو نصيحة</label>
                    <textarea id="editGoalNote" rows="3" placeholder="اكتب ملاحظة تحفيزية لنفسك..."></textarea>
                </div>
                <button type="submit" class="btn-primary">حفظ التعديلات</button>
            </form>
        </div>
    </div>

    <!-- Modal إضافة مهمة جديدة -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>إضافة مهمة جديدة</h2>
            <form id="taskForm">
                <input type="hidden" id="taskGoalId">
                <div class="form-group">
                    <label for="taskName">اسم المهمة</label>
                    <input type="text" id="taskName" required placeholder="مثال: إنهاء دورة HTML الأساسية">
                </div>
                <div class="form-group">
                    <label for="taskDueDate">موعد الإنجاز</label>
                    <input type="date" id="taskDueDate">
                </div>
                <button type="submit" class="btn-primary">حفظ المهمة</button>
            </form>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // العناصر الأساسية
            const goalsContainer = document.getElementById('goalsContainer');
            const todoContainer = document.getElementById('todoContainer');
            const addGoalBtn = document.getElementById('addGoalBtn');
            const goalModal = document.getElementById('goalModal');
            const editGoalModal = document.getElementById('editGoalModal');
            const taskModal = document.getElementById('taskModal');
            const goalForm = document.getElementById('goalForm');
            const editGoalForm = document.getElementById('editGoalForm');
            const taskForm = document.getElementById('taskForm');
            const goalFilter = document.getElementById('goalFilter');
            const darkModeToggle = document.getElementById('darkModeToggle');
            const motivationalQuote = document.getElementById('motivationalQuote');
            const completedGoalsElement = document.getElementById('completedGoals');
            const completedTasksElement = document.getElementById('completedTasks');
            const overallProgressElement = document.getElementById('overallProgress');
            
            // بيانات التطبيق
            let goals = JSON.parse(localStorage.getItem('goals')) || [];
            let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
            
            // عبارات تحفيزية
            const motivationalQuotes = [
                "كل يوم صغير يقربك لهدفك الكبير!",
                "خطوة واحدة اليوم أفضل من لا شيء غداً.",
                "كل إنجاز، مهما كان صغيراً، يستحق الاحتفال!",
                "طريق النجاح يبدأ من خطة واضحة. ابدأ الآن!",
                "لا تتوقف حتى تفخر بنفسك!",
                "أنت أقوى من التحديات التي تواجهك.",
                "كل مهمة تكملها، أنت تبني مستقبلك بيدك!",
                "الثقة بالنفس تبدأ من الالتزام بخطتك.",
                "لو شعرت بالتعب... تذكر لماذا بدأت!",
                "أهدافك تستحق كل جهد تبذله اليوم."
            ];
            
            const completionMessages = [
                "ممتاز! لقد أنجزت مهمة جديدة اليوم!",
                "إنجاز رائع! استمر في التقدم!",
                "أنت على الطريق الصحيح! احتفل بإنجازك!",
                "كل مهمة تكملها تقربك من هدفك!",
                "عمل رائع! أنت تبني عادات النجاح!"
            ];
            
            // تهيئة التطبيق
            initApp();
            
            // وظائف التهيئة
            function initApp() {
                // تحميل الوضع الليلي من localStorage
                const isDarkMode = localStorage.getItem('darkMode') === 'true';
                darkModeToggle.checked = isDarkMode;
                toggleDarkMode(isDarkMode);
                
                // عرض عبارة تحفيزية عشوائية
                showRandomMotivationalQuote();
                
                // تحديث الإحصائيات
                updateStats();
                
                // عرض الأهداف والمهام
                renderGoals();
                renderTasks();
                
                // تحديث قائمة الفلترة بالأهداف
                updateGoalFilter();
                
                // جعل قائمة المهام قابلة للسحب والإفلات
                new Sortable(todoContainer, {
                    animation: 150,
                    handle: '.todo-item',
                    onEnd: function() {
                        // يمكنك حفظ الترتيب الجديد هنا إذا لزم الأمر
                    }
                });
                
                // التحقق من المهام التي عليها تذكير
                checkForTaskReminders();
                
                // إضافة مستمع الأحداث العام لزر المتابعة
                document.addEventListener('click', function(e) {
                    if (e.target && e.target.id === 'closeCelebrationBtn') {
                        const celebrationDiv = document.querySelector('.celebration');
                        if (celebrationDiv) {
                            celebrationDiv.classList.remove('show');
                            setTimeout(() => {
                                celebrationDiv.remove();
                            }, 500);
                        }
                    }
                });
            }
            
            // عرض عبارة تحفيزية عشوائية
            function showRandomMotivationalQuote() {
                const randomIndex = Math.floor(Math.random() * motivationalQuotes.length);
                motivationalQuote.textContent = motivationalQuotes[randomIndex];
                
                // تغيير العبارة كل 30 ثانية
                setInterval(() => {
                    const newIndex = Math.floor(Math.random() * motivationalQuotes.length);
                    motivationalQuote.textContent = motivationalQuotes[newIndex];
                }, 30000);
            }
            
            // تبديل الوضع الليلي
            darkModeToggle.addEventListener('change', function() {
                toggleDarkMode(this.checked);
                localStorage.setItem('darkMode', this.checked);
            });
            
            function toggleDarkMode(enable) {
                document.documentElement.setAttribute('data-theme', enable ? 'dark' : 'light');
            }
            
            // فتح وإغلاق Modal الهدف
            addGoalBtn.addEventListener('click', function() {
                goalModal.style.display = 'block';
            });
            
            document.querySelectorAll('.close').forEach(btn => {
                btn.addEventListener('click', function() {
                    goalModal.style.display = 'none';
                    editGoalModal.style.display = 'none';
                    taskModal.style.display = 'none';
                });
            });
            
            window.addEventListener('click', function(event) {
                if (event.target === goalModal) {
                    goalModal.style.display = 'none';
                }
                if (event.target === editGoalModal) {
                    editGoalModal.style.display = 'none';
                }
                if (event.target === taskModal) {
                    taskModal.style.display = 'none';
                }
            });
            
            // حفظ الهدف الجديد
            goalForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const goalName = document.getElementById('goalName').value;
                const startDate = document.getElementById('startDate').value;
                const endDate = document.getElementById('endDate').value;
                const goalNote = document.getElementById('goalNote').value;
                
                const newGoal = {
                    id: Date.now().toString(),
                    name: goalName,
                    startDate: startDate,
                    endDate: endDate,
                    note: goalNote,
                    progress: 0
                };
                
                goals.push(newGoal);
                saveGoals();
                renderGoals();
                updateGoalFilter();
                
                goalForm.reset();
                goalModal.style.display = 'none';
            });
            
            // حفظ المهمة الجديدة
            taskForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const taskName = document.getElementById('taskName').value;
                const taskDueDate = document.getElementById('taskDueDate').value;
                const goalId = document.getElementById('taskGoalId').value;
                
                const newTask = {
                    id: Date.now().toString(),
                    name: taskName,
                    dueDate: taskDueDate,
                    goalId: goalId,
                    completed: false
                };
                
                tasks.push(newTask);
                saveTasks();
                renderTasks();
                
                // تحديث تقدم الهدف
                updateGoalProgress(goalId);
                
                taskForm.reset();
                taskModal.style.display = 'none';
            });
            
            // تعديل الهدف
            editGoalForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const goalId = document.getElementById('editGoalId').value;
                const goalName = document.getElementById('editGoalName').value;
                const startDate = document.getElementById('editStartDate').value;
                const endDate = document.getElementById('editEndDate').value;
                const goalNote = document.getElementById('editGoalNote').value;
                
                const goalIndex = goals.findIndex(g => g.id === goalId);
                if (goalIndex !== -1) {
                    goals[goalIndex].name = goalName;
                    goals[goalIndex].startDate = startDate;
                    goals[goalIndex].endDate = endDate;
                    goals[goalIndex].note = goalNote;
                    
                    saveGoals();
                    renderGoals();
                    updateGoalFilter();
                    
                    editGoalForm.reset();
                    editGoalModal.style.display = 'none';
                }
            });
            
            // فلترة المهام حسب الهدف
            goalFilter.addEventListener('change', function() {
                renderTasks();
            });
            
            // عرض الأهداف
            function renderGoals() {
                goalsContainer.innerHTML = '';
                
                if (goals.length === 0) {
                    goalsContainer.innerHTML = '<p class="no-goals">لا توجد أهداف مضافّة بعد. اضغط على زر "إضافة هدف جديد" لبدء رحلتك!</p>';
                    return;
                }
                
                goals.forEach(goal => {
                    const goalCard = document.createElement('div');
                    goalCard.className = 'goal-card';
                    goalCard.dataset.goalId = goal.id;
                    
                    const daysLeft = calculateDaysLeft(goal.endDate);
                    const progressPercentage = goal.progress || 0;
                    
                    goalCard.innerHTML = `
                        <h3>${goal.name}</h3>
                        <div class="goal-dates">
                            <span>بداية: ${formatDate(goal.startDate)}</span>
                            <span>نهاية: ${formatDate(goal.endDate)}</span>
                        </div>
                        ${goal.note ? `<div class="goal-note">${goal.note}</div>` : ''}
                        <div class="progress-container">
                            <div class="progress-label">
                                <span>التقدم</span>
                                <span>${progressPercentage}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progressPercentage}%"></div>
                            </div>
                        </div>
                        <div class="goal-actions">
                            <button class="action-btn add-task-btn" data-goal-id="${goal.id}">
                                <i class="fas fa-plus"></i> إضافة مهمة
                            </button>
                            <button class="action-btn view-tasks-btn" data-goal-id="${goal.id}">
                                <i class="fas fa-tasks"></i> عرض المهام
                            </button>
                            <button class="action-btn edit-goal-btn" data-goal-id="${goal.id}">
                                <i class="fas fa-edit"></i> تعديل
                            </button>
                            <button class="action-btn delete-goal-btn" data-goal-id="${goal.id}">
                                <i class="fas fa-trash"></i> حذف
                            </button>
                        </div>
                        ${daysLeft <= 3 ? `<div class="urgent-badge">موعد قريب!</div>` : ''}
                    `;
                    
                    goalsContainer.appendChild(goalCard);
                });
                
                // إضافة مستمعي الأحداث للأزرار
                document.querySelectorAll('.add-task-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const goalId = this.dataset.goalId;
                        document.getElementById('taskGoalId').value = goalId;
                        taskModal.style.display = 'block';
                    });
                });
                
                document.querySelectorAll('.view-tasks-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const goalId = this.dataset.goalId;
                        goalFilter.value = goalId;
                        renderTasks();
                    });
                });
                
                document.querySelectorAll('.edit-goal-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const goalId = this.dataset.goalId;
                        editGoal(goalId);
                    });
                });
                
                document.querySelectorAll('.delete-goal-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const goalId = this.dataset.goalId;
                        deleteGoal(goalId);
                    });
                });
            }
            
            // تعديل الهدف
            function editGoal(goalId) {
                const goal = goals.find(g => g.id === goalId);
                if (!goal) return;
                
                document.getElementById('editGoalId').value = goal.id;
                document.getElementById('editGoalName').value = goal.name;
                document.getElementById('editStartDate').value = goal.startDate;
                document.getElementById('editEndDate').value = goal.endDate;
                document.getElementById('editGoalNote').value = goal.note || '';
                
                editGoalModal.style.display = 'block';
            }
            
            // حذف الهدف
            function deleteGoal(goalId) {
                if (confirm('هل أنت متأكد من حذف هذا الهدف؟ سيتم حذف جميع المهام المرتبطة به أيضًا.')) {
                    // حذف المهام المرتبطة بهذا الهدف أولاً
                    tasks = tasks.filter(task => task.goalId !== goalId);
                    saveTasks();
                    
                    // ثم حذف الهدف نفسه
                    goals = goals.filter(goal => goal.id !== goalId);
                    saveGoals();
                    
                    renderGoals();
                    renderTasks();
                    updateGoalFilter();
                    updateStats();
                }
            }
            
            // عرض المهام
            function renderTasks() {
                todoContainer.innerHTML = '';
                
                const selectedGoalId = goalFilter.value;
                let filteredTasks = tasks;
                
                if (selectedGoalId !== 'all') {
                    filteredTasks = tasks.filter(task => task.goalId === selectedGoalId);
                }
                
                if (filteredTasks.length === 0) {
                    const noTasksMsg = selectedGoalId === 'all' 
                        ? 'لا توجد مهام مضافّة بعد. اضغط على "إضافة مهمة" في أي هدف لبدء التخطيط!' 
                        : 'لا توجد مهام لهذا الهدف بعد. اضغط على "إضافة مهمة" لبدء التخطيط!';
                    
                    todoContainer.innerHTML = `<p class="no-tasks">${noTasksMsg}</p>`;
                    return;
                }
                
                filteredTasks.forEach(task => {
                    const taskItem = document.createElement('div');
                    taskItem.className = 'todo-item';
                    taskItem.dataset.taskId = task.id;
                    
                    const goal = goals.find(g => g.id === task.goalId);
                    const goalName = goal ? goal.name : 'هدف غير معروف';
                    
                    taskItem.innerHTML = `
                        <input type="checkbox" class="todo-checkbox" ${task.completed ? 'checked' : ''}>
                        <span class="todo-text ${task.completed ? 'completed' : ''}">${task.name}</span>
                        ${task.dueDate ? `<span class="todo-due-date">${formatDate(task.dueDate)}</span>` : ''}
                        <div class="todo-actions">
                            <button class="edit-task-btn" data-task-id="${task.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="delete-task-btn" data-task-id="${task.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <span class="goal-badge">${goalName}</span>
                    `;
                    
                    todoContainer.appendChild(taskItem);
                });
                
                // إضافة مستمعي الأحداث للأزرار
                document.querySelectorAll('.todo-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        const taskId = this.closest('.todo-item').dataset.taskId;
                        const task = tasks.find(t => t.id === taskId);
                        
                        if (task) {
                            task.completed = this.checked;
                            saveTasks();
                            
                            // تحديث تقدم الهدف
                            if (task.goalId) {
                                updateGoalProgress(task.goalId);
                            }
                            
                            // عرض رسالة تحفيزية إذا تم إكمال المهمة
                            if (this.checked) {
                                showCompletionMessage();
                            }
                            
                            // تحديث الإحصائيات
                            updateStats();
                        }
                    });
                });
                
                document.querySelectorAll('.edit-task-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const taskId = this.dataset.taskId;
                        editTask(taskId);
                    });
                });
                
                document.querySelectorAll('.delete-task-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const taskId = this.dataset.taskId;
                        deleteTask(taskId);
                    });
                });
            }
            
            // تعديل المهمة
            function editTask(taskId) {
                const task = tasks.find(t => t.id === taskId);
                if (!task) return;
                
                document.getElementById('taskName').value = task.name;
                document.getElementById('taskDueDate').value = task.dueDate || '';
                document.getElementById('taskGoalId').value = task.goalId;
                
                taskModal.style.display = 'block';
                
                // حذف المهمة القديمة عند حفظ التعديلات
                taskForm.onsubmit = function(e) {
                    e.preventDefault();
                    
                    const taskIndex = tasks.findIndex(t => t.id === taskId);
                    if (taskIndex !== -1) {
                        tasks.splice(taskIndex, 1);
                    }
                    
                    taskForm.onsubmit = null;
                    taskForm.dispatchEvent(new Event('submit'));
                };
            }
            
            // حذف المهمة
            function deleteTask(taskId) {
                if (confirm('هل أنت متأكد من حذف هذه المهمة؟')) {
                    const taskIndex = tasks.findIndex(t => t.id === taskId);
                    if (taskIndex !== -1) {
                        const task = tasks[taskIndex];
                        tasks.splice(taskIndex, 1);
                        saveTasks();
                        
                        // تحديث تقدم الهدف
                        if (task.goalId) {
                            updateGoalProgress(task.goalId);
                        }
                        
                        renderTasks();
                        updateStats();
                    }
                }
            }
            
            // تحديث تقدم الهدف
            function updateGoalProgress(goalId) {
                const goalTasks = tasks.filter(task => task.goalId === goalId);
                
                if (goalTasks.length === 0) {
                    return;
                }
                
                const completedTasks = goalTasks.filter(task => task.completed).length;
                const progress = Math.round((completedTasks / goalTasks.length) * 100);
                
                const goalIndex = goals.findIndex(g => g.id === goalId);
                if (goalIndex !== -1) {
                    goals[goalIndex].progress = progress;
                    saveGoals();
                    renderGoals();
                    
                    // إذا اكتمل الهدف (100%)
                    if (progress === 100) {
                        showGoalCompletionMessage(goals[goalIndex].name);
                    }
                }
            }
            
            // عرض رسالة إنجاز عند إكمال هدف
            function showGoalCompletionMessage(goalName) {
                const celebrationDiv = document.createElement('div');
                celebrationDiv.className = 'celebration';
                celebrationDiv.innerHTML = `
                    <div class="celebration-content">
                        <h2>تهانينا! 🎉</h2>
                        <p>لقد أكملت هدفك "${goalName}" بنجاح!</p>
                        <p>استمر في التقدم ولا تتوقف!</p>
                        <button class="btn-primary" id="closeCelebrationBtn">متابعة</button>
                    </div>
                `;
                
                document.body.appendChild(celebrationDiv);
                
                setTimeout(() => {
                    celebrationDiv.classList.add('show');
                }, 100);
            }
            
            // تحديث قائمة فلترة الأهداف
            function updateGoalFilter() {
                goalFilter.innerHTML = '<option value="all">كل الأهداف</option>';
                
                goals.forEach(goal => {
                    const option = document.createElement('option');
                    option.value = goal.id;
                    option.textContent = goal.name;
                    goalFilter.appendChild(option);
                });
            }
            
            // تحديث الإحصائيات
            function updateStats() {
                // عدد الأهداف المكتملة
                const completedGoalsCount = goals.filter(goal => goal.progress === 100).length;
                completedGoalsElement.textContent = completedGoalsCount;
                
                // عدد المهام المكتملة
                const completedTasksCount = tasks.filter(task => task.completed).length;
                completedTasksElement.textContent = completedTasksCount;
                
                // نسبة التقدم العامة
                const totalTasks = tasks.length;
                const overallProgress = totalTasks > 0 
                    ? Math.round((completedTasksCount / totalTasks) * 100) 
                    : 0;
                overallProgressElement.textContent = `${overallProgress}%`;
            }
            
            // عرض رسالة إنجاز عند إكمال مهمة
            function showCompletionMessage() {
                const randomIndex = Math.floor(Math.random() * completionMessages.length);
                const message = completionMessages[randomIndex];
                
                // يمكنك هنا إضافة تأثير مرئي أو عرض إشعار
                alert(message); // يمكن استبدال هذا ب modal أجمل
            }
            
            // التحقق من المهام التي عليها تذكير
            function checkForTaskReminders() {
                const now = new Date();
                const today = now.toISOString().split('T')[0];
                
                tasks.forEach(task => {
                    if (task.dueDate && !task.completed && task.dueDate === today) {
                        // يمكنك هنا إضافة إشعار للمستخدم
                        console.log(`تذكير: المهمة "${task.name}" تنتهي اليوم!`);
                    }
                });
            }
            
            // حفظ الأهداف في localStorage
            function saveGoals() {
                localStorage.setItem('goals', JSON.stringify(goals));
            }
            
            // حفظ المهام في localStorage
            function saveTasks() {
                localStorage.setItem('tasks', JSON.stringify(tasks));
            }
            
            // وظائف مساعدة
            function formatDate(dateString) {
                if (!dateString) return '';
                
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                const date = new Date(dateString);
                return date.toLocaleDateString('ar-EG', options);
            }
            
            function calculateDaysLeft(endDate) {
                const today = new Date();
                const end = new Date(endDate);
                const diffTime = end - today;
                return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            }
            
            // تهيئة تاريخ البداية والنهاية في نموذج الهدف
            document.getElementById('startDate').valueAsDate = new Date();
            const endDateInput = document.getElementById('endDate');
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            endDateInput.valueAsDate = tomorrow;
        });
    </script>
</body>
</html>
